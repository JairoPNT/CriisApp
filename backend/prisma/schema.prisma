generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int        @id @default(autoincrement())
  username           String     @unique
  password           String
  role               String
  createdAt          DateTime   @default(now())
  avatar             String?
  email              String?    @unique
  phone              String?
  name               String?
  authCode           String?    @unique
  achievements       String?
  address            String?
  businessName       String?
  contactPerson      String?
  experience         String?
  nit                String?
  specialties        String?
  titles             String?
  calendarId         String?
  trainingInfo       String?
  tickets            Ticket[]   @relation("AssignedTickets")
  createdTickets     Ticket[]   @relation("CreatedTickets")
  trainingsRequested Training[] @relation("EntityTrainings")
  trainingsManaged   Training[] @relation("ManagerTrainings")
}

model Ticket {
  id            String     @id
  patientName   String
  contactMethod String
  city          String
  phone         String
  email         String
  description   String
  status        String     @default("INICIAL")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  revenue       Float?
  assignedToId  Int?
  isArchived    Boolean    @default(false)
  creatorId     Int?
  followUps     FollowUp[]
  media         Media[]
  assignedTo    User?      @relation("AssignedTickets", fields: [assignedToId], references: [id])
  creator       User?      @relation("CreatedTickets", fields: [creatorId], references: [id])
}

model SystemSetting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model FollowUp {
  id        Int      @id @default(autoincrement())
  ticketId  String
  content   String
  diagnosis String?
  protocol  String?
  bonusInfo String?
  createdAt DateTime @default(now())
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  media     Media[]
}

model Media {
  id         Int       @id @default(autoincrement())
  ticketId   String
  url        String
  createdAt  DateTime  @default(now())
  followUpId Int?
  followUp   FollowUp? @relation(fields: [followUpId], references: [id])
  ticket     Ticket    @relation(fields: [ticketId], references: [id])
}

model Training {
  id              Int      @id @default(autoincrement())
  startTime       DateTime
  endTime         DateTime
  entityId        Int
  status          String   @default("PENDIENTE")
  calendarEventId String?
  createdAt       DateTime @default(now())
  attendance      Int?
  description     String?
  isCompleted     Boolean  @default(false)
  managerId       Int?
  notesPost       String?
  notesPre        String?
  salesVolume     Float?
  updatedAt       DateTime @default(now()) @updatedAt
  entity          User     @relation("EntityTrainings", fields: [entityId], references: [id])
  manager         User?    @relation("ManagerTrainings", fields: [managerId], references: [id])
}
